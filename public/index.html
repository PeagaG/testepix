<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PIX</title>
  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { margin:0; min-height:100dvh; display:grid; place-items:center; background:#0f172a; color:#e2e8f0; }
    .wrap { width:100%; max-width:420px; padding:20px; }
    .box  { background:#111827; border:1px solid #1f2937; border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .qr   { display:grid; place-items:center; background:#0b1220; border:1px dashed #334155; border-radius:12px; padding:16px; margin-bottom:14px; }
    #qr   { width:100%; max-width:320px; background:#fff; padding:10px; border-radius:8px; image-rendering: crisp-edges; }
    button{ width:100%; padding:12px 14px; border-radius:10px; border:1px solid #2563eb; background:#2563eb; color:#fff; font-size:16px; cursor:pointer; }
    button:active{ transform:translateY(1px); }
    .msg  { text-align:center; font-size:13px; color:#94a3b8; margin-bottom:10px; min-height:1.2em; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="box">
      <div id="msg" class="msg">Gerando PIX…</div>
      <div class="qr">
        <img id="qr" alt="QR Code do PIX" />
      </div>
      <button id="copyBtn">Copiar código PIX</button>
    </div>
  </div>

  <script>
    const msg = document.getElementById("msg");
    const img = document.getElementById("qr");
    const copyBtn = document.getElementById("copyBtn");
    let copiaECola = "";

    async function gerarPix() {
      try {
        msg.textContent = "Gerando PIX…";
        // servidor já assume 1000 (R$10) se não mandar valor; pode mudar no server se quiser
        const res = await fetch("/pix", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: "{}"
        });
        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error((err.message || err.error || "erro") + " (HTTP " + res.status + ")");
        }
        const data = await res.json();
        copiaECola = data.qr_code || "";
        img.src = data.qr_code_base64 || "";
        msg.textContent = "PIX pronto";
      } catch (e) {
        console.error(e);
        msg.textContent = "Falha ao gerar PIX: " + e.message;
      }
    }

    copyBtn.addEventListener("click", async () => {
      if (!copiaECola) return;
      await navigator.clipboard.writeText(copiaECola);
      const old = copyBtn.textContent;
      copyBtn.textContent = "✅ Copiado";
      setTimeout(() => (copyBtn.textContent = old), 1200);
    });

    // gera automaticamente a cada F5/abertura
    window.addEventListener("load", gerarPix);
  </script>
</body>
</html>
